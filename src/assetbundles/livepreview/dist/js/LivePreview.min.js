!function(e){var n=!1;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var o=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=o,t}}}(function(){function g(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}return function e(l){function C(e,n,o){var t;if("undefined"!=typeof document){if(1<arguments.length){if("number"==typeof(o=g({path:"/"},C.defaults,o)).expires){var r=new Date;r.setMilliseconds(r.getMilliseconds()+864e5*o.expires),o.expires=r}o.expires=o.expires?o.expires.toUTCString():"";try{t=JSON.stringify(n),/^[\{\[]/.test(t)&&(n=t)}catch(e){}n=l.write?l.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var i="";for(var c in o)o[c]&&(i+="; "+c,!0!==o[c]&&(i+="="+o[c]));return document.cookie=e+"="+n+i}e||(t={});for(var a=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,f=0;f<a.length;f++){var p=a[f].split("="),d=p.slice(1).join("=");this.json||'"'!==d.charAt(0)||(d=d.slice(1,-1));try{var u=p[0].replace(s,decodeURIComponent);if(d=l.read?l.read(d,u):l(d,u)||d.replace(s,decodeURIComponent),this.json)try{d=JSON.parse(d)}catch(e){}if(e===u){t=d;break}e||(t[u]=d)}catch(e){}}return t}}return(C.set=C).get=function(e){return C.call(C,e)},C.getJSON=function(){return C.apply({json:!0},[].slice.call(arguments))},C.defaults={},C.remove=function(e,n){C(e,"",g(n,{expires:-1}))},C.withConverter=e,C}(function(){})});
var Arrive=function(s,e,u){"use strict";if(s.MutationObserver&&"undefined"!=typeof HTMLElement){var n,t,r=0,d=(n=HTMLElement.prototype.matches||HTMLElement.prototype.webkitMatchesSelector||HTMLElement.prototype.mozMatchesSelector||HTMLElement.prototype.msMatchesSelector,{matchesSelector:function(e,t){return e instanceof HTMLElement&&n.call(e,t)},addMethod:function(e,t,n){var r=e[t];e[t]=function(){return n.length==arguments.length?n.apply(this,arguments):"function"==typeof r?r.apply(this,arguments):void 0}},callCallbacks:function(e,t){t&&t.options.onceOnly&&1==t.firedElems.length&&(e=[e[0]]);for(var n,r=0;n=e[r];r++)n&&n.callback&&n.callback.call(n.elem,n.elem);t&&t.options.onceOnly&&1==t.firedElems.length&&t.me.unbindEventWithSelectorAndCallback.call(t.target,t.selector,t.callback)},checkChildNodesRecursively:function(e,t,n,r){for(var i,o=0;i=e[o];o++)n(i,t,r)&&r.push({callback:t.callback,elem:i}),0<i.childNodes.length&&d.checkChildNodesRecursively(i.childNodes,t,n,r)},mergeArrays:function(e,t){var n,r={};for(n in e)e.hasOwnProperty(n)&&(r[n]=e[n]);for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},toElementsArray:function(e){return void 0===e||"number"==typeof e.length&&e!==s||(e=[e]),e}}),f=((t=function(){this._eventsBucket=[],this._beforeAdding=null,this._beforeRemoving=null}).prototype.addEvent=function(e,t,n,r){var i={target:e,selector:t,options:n,callback:r,firedElems:[]};return this._beforeAdding&&this._beforeAdding(i),this._eventsBucket.push(i),i},t.prototype.removeEvent=function(e){for(var t,n=this._eventsBucket.length-1;t=this._eventsBucket[n];n--)if(e(t)){this._beforeRemoving&&this._beforeRemoving(t);var r=this._eventsBucket.splice(n,1);r&&r.length&&(r[0].callback=null)}},t.prototype.beforeAdding=function(e){this._beforeAdding=e},t.prototype.beforeRemoving=function(e){this._beforeRemoving=e},t),l=function(i,o){var l=new f,c=this,a={fireOnAttributesModification:!1};return l.beforeAdding(function(t){var e,n=t.target;n!==s.document&&n!==s||(n=document.getElementsByTagName("html")[0]),e=new MutationObserver(function(e){o.call(this,e,t)});var r=i(t.options);e.observe(n,r),t.observer=e,t.me=c}),l.beforeRemoving(function(e){e.observer.disconnect()}),this.bindEvent=function(e,t,n){t=d.mergeArrays(a,t);for(var r=d.toElementsArray(this),i=0;i<r.length;i++)l.addEvent(r[i],e,t,n)},this.unbindEvent=function(){var n=d.toElementsArray(this);l.removeEvent(function(e){for(var t=0;t<n.length;t++)if(this===u||e.target===n[t])return!0;return!1})},this.unbindEventWithSelectorOrCallback=function(n){var e,r=d.toElementsArray(this),i=n;e="function"==typeof n?function(e){for(var t=0;t<r.length;t++)if((this===u||e.target===r[t])&&e.callback===i)return!0;return!1}:function(e){for(var t=0;t<r.length;t++)if((this===u||e.target===r[t])&&e.selector===n)return!0;return!1},l.removeEvent(e)},this.unbindEventWithSelectorAndCallback=function(n,r){var i=d.toElementsArray(this);l.removeEvent(function(e){for(var t=0;t<i.length;t++)if((this===u||e.target===i[t])&&e.selector===n&&e.callback===r)return!0;return!1})},this},i=new function(){var a={fireOnAttributesModification:!1,onceOnly:!1,existing:!1};function o(e,t,n){return!(!d.matchesSelector(e,t.selector)||(e._id===u&&(e._id=r++),-1!=t.firedElems.indexOf(e._id))||(t.firedElems.push(e._id),0))}var s=(i=new l(function(e){var t={attributes:!1,childList:!0,subtree:!0};return e.fireOnAttributesModification&&(t.attributes=!0),t},function(e,i){e.forEach(function(e){var t=e.addedNodes,n=e.target,r=[];null!==t&&0<t.length?d.checkChildNodesRecursively(t,i,o,r):"attributes"===e.type&&o(n,i)&&r.push({callback:i.callback,elem:n}),d.callCallbacks(r,i)})})).bindEvent;return i.bindEvent=function(e,t,n){t=void 0===n?(n=t,a):d.mergeArrays(a,t);var r=d.toElementsArray(this);if(t.existing){for(var i=[],o=0;o<r.length;o++)for(var l=r[o].querySelectorAll(e),c=0;c<l.length;c++)i.push({callback:n,elem:l[c]});if(t.onceOnly&&i.length)return n.call(i[0].elem,i[0].elem);setTimeout(d.callCallbacks,1,i)}s.call(this,e,t,n)},i},c=new function(){var r={};function i(e,t){return d.matchesSelector(e,t.selector)}var o=(c=new l(function(){return{childList:!0,subtree:!0}},function(e,r){e.forEach(function(e){var t=e.removedNodes,n=[];null!==t&&0<t.length&&d.checkChildNodesRecursively(t,r,i,n),d.callCallbacks(n,r)})})).bindEvent;return c.bindEvent=function(e,t,n){t=void 0===n?(n=t,r):d.mergeArrays(r,t),o.call(this,e,t,n)},c};e&&h(e.fn),h(HTMLElement.prototype),h(NodeList.prototype),h(HTMLCollection.prototype),h(HTMLDocument.prototype),h(Window.prototype);var o={};return a(i,o,"unbindAllArrive"),a(c,o,"unbindAllLeave"),o}function a(e,t,n){d.addMethod(t,n,e.unbindEvent),d.addMethod(t,n,e.unbindEventWithSelectorOrCallback),d.addMethod(t,n,e.unbindEventWithSelectorAndCallback)}function h(e){e.arrive=i.bindEvent,a(i,e,"unbindArrive"),e.leave=c.bindEvent,a(c,e,"unbindLeave")}}(window,"undefined"==typeof jQuery?null:jQuery,void 0);
"undefined"==typeof Portal&&(Portal={}),Portal.LivePreview=Garnish.Base.extend({$toolbar:null,$deviceMask:null,$zoomMenu:null,$breakpointButtons:null,$iframe:null,zoomMenuBtn:null,targetMenuBtn:null,targetOptions:[],rotatingTimeout:null,init:function(t){this.setSettings(t,Portal.LivePreview.defaults),this.settings.context&&($.each(this.settings.targets.global,$.proxy(function(t,e){this.targetOptions.push(e)},this)),$.each(this.settings.targets[this.settings.context],$.proxy(function(t,e){this.targetOptions.push(e)},this))),Cookies.remove("portal_template"),(this.settings.showBreakpoints||0!==this.targetOptions.length)&&(Garnish.on(Craft.LivePreview,"enter",$.proxy(function(t){this.onEnter(t)},this)),Garnish.on(Craft.LivePreview,"exit",$.proxy(function(t){this.onExit(t)},this)))},onEnter:function(t){Craft.livePreview.$iframeContainer.arrive(".lp-iframe",$.proxy(function(t){this.$iframe=$(t),this.settings.showBreakpoints&&this.addListener(Craft.livePreview.$editor,"resize","toggleToolbar"),this.attachToolbar(),$(".portal-lp-btn--active",this.$breakpointButtons).click()},this))},onExit:function(t){this.settings.showBreakpoints&&this.removeListener(Craft.livePreview.$editor,"resize"),Craft.livePreview.$iframeContainer.unbindArrive(".lp-iframe")},toggleToolbar:function(){1024<Craft.livePreview.$iframeContainer.outerWidth()?this.attachToolbar():this.detachToolbar()},attachToolbar:function(){if(Craft.livePreview.$iframeContainer.addClass("portal-lp"),!this.$toolbar){this.$toolbar=$('<header class="header" />');var t=$('<div class="btngroup portal-lp-btngroup no-outline" />').appendTo(this.$toolbar);if(this.settings.showBreakpoints){this.$breakpointButtons=$('<div class="btngroup portal-lp-breakpoints" />').appendTo(this.$toolbar),$('<div class="portal-lp-btn portal-lp-btn--desktop" data-width="" data-height="" data-breakpoint="desktop" title="'+Craft.t("portal","Desktop")+'" />').appendTo(this.$breakpointButtons),$('<div class="portal-lp-btn portal-lp-btn--tablet" data-width="768" data-height="1006" data-breakpoint="tablet" title="'+Craft.t("portal","Tablet")+'" />').appendTo(this.$breakpointButtons),$('<div class="portal-lp-btn portal-lp-btn--mobile" data-width="375" data-height="653" data-breakpoint="mobile" title="'+Craft.t("portal","Mobile")+'" />').appendTo(this.$breakpointButtons);var e=$('<div class="btn portal-lp-zoom-btn menubtn no-outline">'+Craft.t("portal","Zoom")+"</div>").appendTo(t);this.$zoomMenu=$('<div class="menu portal-lp-menu" />').appendTo(t);var a=$("<ul />").appendTo(this.$zoomMenu);$('<li><a data-zoom="full">100%</a></li>').appendTo(a),$('<li><a data-zoom="threequarters" class="sel">75%</a></li>').appendTo(a),$('<li><a data-zoom="half">50%</a></li>').appendTo(a),this.zoomMenuBtn=new Garnish.MenuBtn(e,{onOptionSelect:$.proxy(this,"onZoom")});var i=$('<div class="btn portal-lp-orientation-btn" data-icon="refresh"></div>').appendTo(t);this.addListener(i,"activate","toggleOrientation")}if(0<this.targetOptions.length){var r=$('<div class="menu portal-lp-menu" />').prependTo(t),o=$('<div class="btn menubtn no-outline">'+Craft.t("portal","Choose Target")+"</div>").prependTo(t),n=$("<ul />").appendTo(r);$('<li><a data-template="" class="sel">Primary Page</a></li>').appendTo(n),$.each(this.targetOptions,$.proxy(function(t,e){var a=null;$.each(e.siteSettings,$.proxy(function(t,e){e.siteId==this.settings.siteId&&(a=e)},this)),null!==a&&$('<li><a data-template="'+a.template+'">'+e.name+"</a></li>").appendTo(n)},this)),this.targetMenuBtn=new Garnish.MenuBtn(o,{onOptionSelect:$.proxy(this,"onChangeTarget")})}if(this.settings.showBreakpoints){this.addListener($(".portal-lp-btn",this.$breakpointButtons),"activate","changeBreakpoint");var s=Cookies.get("portal_breakpoint");s&&this.$breakpointButtons.find('.portal-lp-btn[data-breakpoint="'+s+'"]').click()}}if(this.settings.showBreakpoints&&!this.$deviceMask&&(this.$deviceMask=$('<div class="portal-lp-device-mask" />')),this.$toolbar.prependTo(Craft.livePreview.$iframeContainer),this.$deviceMask&&this.$deviceMask.appendTo(Craft.livePreview.$iframeContainer),this.settings.showBreakpoints){s&&"tablet"===s&&Craft.livePreview.$iframeContainer.addClass("portal-lp--tablet");var l=Cookies.get("portal_orientation");s&&"desktop"!==s&&l&&"landscape"===l&&Craft.livePreview.$iframeContainer.addClass("portal-lp--landscape");var p=Cookies.get("portal_zoom");p&&"threequarters"!==p&&(Craft.livePreview.$iframeContainer.addClass("portal-lp--zoom-"+p),this.$zoomMenu.find("a.sel").removeClass("sel"),this.$zoomMenu.find("a[data-zoom="+p+"]").addClass("sel"))}},detachToolbar:function(){Craft.livePreview.$iframeContainer.removeClass("portal-lp"),Craft.livePreview.$iframeContainer.removeClass("portal-lp--landscape"),this.resetIframe(),this.$toolbar&&this.$toolbar.detach(),this.$deviceMask&&this.$deviceMask.detach()},changeBreakpoint:function(t){var e=$(t.target),a=e.data("width"),i=e.data("height"),r=e.data("breakpoint");Cookies.set("portal_breakpoint",r),$(".portal-lp-btn",this.$toolbar).removeClass("portal-lp-btn--active"),e.addClass("portal-lp-btn--active");var o=Cookies.get("portal_orientation");o&&"landscape"===o&&(a=e.data("height"),i=e.data("width"),Craft.livePreview.$iframeContainer.addClass("portal-lp--landscape")),""!==a&&""!==i?(this.targetMenuBtn&&this.targetMenuBtn.menu.$container.addClass("dark"),this.zoomMenuBtn&&this.zoomMenuBtn.menu.$container.addClass("dark"),Craft.livePreview.$iframeContainer.addClass("portal-lp--resized"),"tablet"===r?Craft.livePreview.$iframeContainer.addClass("portal-lp--tablet"):Craft.livePreview.$iframeContainer.removeClass("portal-lp--tablet"),this.$iframe.css({width:a+"px",height:i+"px",marginLeft:"-"+a/2+"px"})):this.resetIframe()},toggleOrientation:function(t){var a=$(t.target);if(!a.data("portal-working")){a.data("portal-working",!0);var i=Cookies.get("portal_orientation");i&&"portrait"!==i?(i="portrait",Craft.livePreview.$iframeContainer.removeClass("portal-lp--landscape")):(i="landscape",Craft.livePreview.$iframeContainer.addClass("portal-lp--landscape")),Cookies.set("portal_orientation",i);var e=Cookies.get("portal_breakpoint");e&&"desktop"!==e?(clearTimeout(this.rotatingTimeout),Craft.livePreview.$iframeContainer.addClass("portal-lp--rotating"),this.rotatingTimeout=setTimeout($.proxy(function(){var t=this.$iframe.outerWidth(),e=this.$iframe.outerHeight();("portrait"===i&&e<t||"landscape"===i&&t<e)&&this.$iframe.css({width:e+"px",height:t+"px",marginLeft:"-"+e/2+"px"}),Craft.livePreview.$iframeContainer.addClass("portal-lp--rotating-done"),Craft.livePreview.$iframeContainer.removeClass("portal-lp--rotating"),setTimeout(function(){Craft.livePreview.$iframeContainer.removeClass("portal-lp--rotating-done"),a.data("portal-working",!1)},50)},this),350)):a.data("portal-working",!1)}},resetIframe:function(){this.targetMenuBtn&&this.targetMenuBtn.menu.$container.removeClass("dark"),this.zoomMenuBtn&&this.zoomMenuBtn.menu.$container.removeClass("dark"),Craft.livePreview.$iframeContainer.removeClass("portal-lp--resized"),Craft.livePreview.$iframeContainer.removeClass("portal-lp--tablet"),Craft.livePreview.$iframeContainer.removeClass("portal-lp--landscape"),this.$iframe.css({width:"100%",height:"100%",marginLeft:"0"})},onChangeTarget:function(t){var e=$(t),a=e.data("template");e.parent().siblings().find("a.sel").removeClass("sel"),e.addClass("sel"),Cookies.set("portal_template",a),Craft.livePreview.forceUpdateIframe()},onZoom:function(t){var e=$(t),a=e.data("zoom");e.parent().siblings().find("a.sel").removeClass("sel"),e.addClass("sel"),Cookies.set("portal_zoom",a),"full"===a&&(Craft.livePreview.$iframeContainer.removeClass("portal-lp--zoom-half"),Craft.livePreview.$iframeContainer.addClass("portal-lp--zoom-full")),"threequarters"===a&&(Craft.livePreview.$iframeContainer.removeClass("portal-lp--zoom-full"),Craft.livePreview.$iframeContainer.removeClass("portal-lp--zoom-half")),"half"===a&&(Craft.livePreview.$iframeContainer.removeClass("portal-lp--zoom-full"),Craft.livePreview.$iframeContainer.addClass("portal-lp--zoom-half"))}},{defaults:{siteId:null,targets:null,context:null,showBreakpoints:!0}});