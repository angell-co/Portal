!function(e){var n=!1;if("function"==typeof define&&define.amd&&(define(e),n=!0),"object"==typeof exports&&(module.exports=e(),n=!0),!n){var o=window.Cookies,t=window.Cookies=e();t.noConflict=function(){return window.Cookies=o,t}}}(function(){function g(){for(var e=0,n={};e<arguments.length;e++){var o=arguments[e];for(var t in o)n[t]=o[t]}return n}return function e(l){function C(e,n,o){var t;if("undefined"!=typeof document){if(1<arguments.length){if("number"==typeof(o=g({path:"/"},C.defaults,o)).expires){var r=new Date;r.setMilliseconds(r.getMilliseconds()+864e5*o.expires),o.expires=r}o.expires=o.expires?o.expires.toUTCString():"";try{t=JSON.stringify(n),/^[\{\[]/.test(t)&&(n=t)}catch(e){}n=l.write?l.write(n,e):encodeURIComponent(String(n)).replace(/%(23|24|26|2B|3A|3C|3E|3D|2F|3F|40|5B|5D|5E|60|7B|7D|7C)/g,decodeURIComponent),e=(e=(e=encodeURIComponent(String(e))).replace(/%(23|24|26|2B|5E|60|7C)/g,decodeURIComponent)).replace(/[\(\)]/g,escape);var i="";for(var c in o)o[c]&&(i+="; "+c,!0!==o[c]&&(i+="="+o[c]));return document.cookie=e+"="+n+i}e||(t={});for(var a=document.cookie?document.cookie.split("; "):[],s=/(%[0-9A-Z]{2})+/g,f=0;f<a.length;f++){var p=a[f].split("="),d=p.slice(1).join("=");this.json||'"'!==d.charAt(0)||(d=d.slice(1,-1));try{var u=p[0].replace(s,decodeURIComponent);if(d=l.read?l.read(d,u):l(d,u)||d.replace(s,decodeURIComponent),this.json)try{d=JSON.parse(d)}catch(e){}if(e===u){t=d;break}e||(t[u]=d)}catch(e){}}return t}}return(C.set=C).get=function(e){return C.call(C,e)},C.getJSON=function(){return C.apply({json:!0},[].slice.call(arguments))},C.defaults={},C.remove=function(e,n){C(e,"",g(n,{expires:-1}))},C.withConverter=e,C}(function(){})});
"undefined"==typeof Portal&&(Portal={}),Portal.LivePreview=Garnish.Base.extend({$toolbar:null,$deviceMask:null,targetMenuBtn:null,targetOptions:[],rotatingTimeout:null,init:function(t){this.setSettings(t,Portal.LivePreview.defaults),this.settings.context&&($.each(this.settings.targets.global,$.proxy(function(t,e){this.targetOptions.push(e)},this)),$.each(this.settings.targets[this.settings.context],$.proxy(function(t,e){this.targetOptions.push(e)},this))),Cookies.remove("portal_template"),(this.settings.showBreakpoints||0!==this.targetOptions.length)&&(Garnish.on(Craft.LivePreview,"enter",$.proxy(function(t){this.onEnter(t)},this)),Garnish.on(Craft.LivePreview,"exit",$.proxy(function(t){this.onExit(t)},this)))},onEnter:function(t){this.settings.showBreakpoints&&this.addListener(Craft.livePreview.$editor,"resize","toggleToolbar"),this.attachToolbar()},onExit:function(t){this.settings.showBreakpoints&&this.removeListener(Craft.livePreview.$editor,"resize")},toggleToolbar:function(){1024<Craft.livePreview.$iframeContainer.outerWidth()?this.attachToolbar():this.detachToolbar()},attachToolbar:function(){if(Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container"),!this.$toolbar){if(this.$toolbar=$('<header class="header" />'),this.settings.showBreakpoints){var t=$('<div class="btngroup" />').appendTo(this.$toolbar);$('<div class="portal-lp-btn portal-lp-btn--desktop" data-width="" data-height="" data-breakpoint="desktop" title="'+Craft.t("portal","Desktop")+'" />').appendTo(t),$('<div class="portal-lp-btn portal-lp-btn--tablet" data-width="768" data-height="1006" data-breakpoint="tablet" title="'+Craft.t("portal","Tablet")+'" />').appendTo(t),$('<div class="portal-lp-btn portal-lp-btn--mobile" data-width="375" data-height="653" data-breakpoint="mobile" title="'+Craft.t("portal","Mobile")+'" />').appendTo(t);var e=$('<div class="btn portal-lp-orientation-btn" data-icon="refresh"></div>').appendTo(this.$toolbar);this.addListener(e,"activate","toggleOrientation")}if(0<this.targetOptions.length){var a=$('<div class="btn menubtn right no-outline">'+Craft.t("portal","Choose Target")+"</div>").appendTo(this.$toolbar),i=$('<div class="menu" />').appendTo(this.$toolbar),r=$("<ul />").appendTo(i);$('<li><a data-template="">Primary Page</a></li>').appendTo(r),$.each(this.targetOptions,$.proxy(function(t,e){var a=null;$.each(e.siteSettings,$.proxy(function(t,e){e.siteId==this.settings.siteId&&(a=e)},this)),null!==a&&$('<li><a data-template="'+a.template+'">'+e.name+"</a></li>").appendTo(r)},this)),this.targetMenuBtn=new Garnish.MenuBtn(a,{onOptionSelect:function(t){var e=$(t).data("template");Cookies.set("portal_template",e),Craft.livePreview.forceUpdateIframe()}})}if(this.settings.showBreakpoints){this.addListener($(".portal-lp-btn",t),"activate","changeBreakpoint");var o=Cookies.get("portal_breakpoint");o&&t.find('.portal-lp-btn[data-breakpoint="'+o+'"]').click()}}if(this.settings.showBreakpoints&&!this.$deviceMask&&(this.$deviceMask=$('<div class="portal-device-mask" />')),this.$toolbar.prependTo(Craft.livePreview.$iframeContainer),this.$deviceMask&&this.$deviceMask.appendTo(Craft.livePreview.$iframeContainer),this.settings.showBreakpoints){o&&"tablet"===o&&Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container--tablet");var n=Cookies.get("portal_orientation");o&&"desktop"!==o&&n&&"landscape"===n&&Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container--landscape")}},detachToolbar:function(){Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container"),Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container--landscape"),this.resetIframe(),this.$toolbar&&this.$toolbar.detach(),this.$deviceMask&&this.$deviceMask.detach()},changeBreakpoint:function(t){var e=$(t.target),a=e.data("width"),i=e.data("height"),r=e.data("breakpoint");Cookies.set("portal_breakpoint",r),$(".portal-lp-btn",this.$toolbar).removeClass("portal-lp-btn--active"),e.addClass("portal-lp-btn--active");var o=Cookies.get("portal_orientation");o&&"landscape"===o&&(a=e.data("height"),i=e.data("width"),Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container--landscape")),""!==a&&""!==i?(this.targetMenuBtn&&this.targetMenuBtn.menu.$container.addClass("dark"),Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container--resized"),"tablet"===r?Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container--tablet"):Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container--tablet"),Craft.livePreview.$iframe.css({width:a+"px",height:i+"px",left:"50%",marginLeft:"-"+a/2+"px"})):this.resetIframe(),Craft.livePreview.forceUpdateIframe()},toggleOrientation:function(t){var a=$(t.target);if(!a.data("portal-working")){a.data("portal-working",!0);var i=Cookies.get("portal_orientation");i&&"portrait"!==i?(i="portrait",Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container--landscape")):(i="landscape",Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container--landscape")),Cookies.set("portal_orientation",i);var e=Cookies.get("portal_breakpoint");e&&"desktop"!==e?(clearTimeout(this.rotatingTimeout),Craft.livePreview.$iframeContainer.addClass("portal-lp-iframe-container--rotating"),this.rotatingTimeout=setTimeout(function(){var t=Craft.livePreview.$iframe.outerWidth(),e=Craft.livePreview.$iframe.outerHeight();("portrait"===i&&e<t||"landscape"===i&&t<e)&&Craft.livePreview.$iframe.css({width:e+"px",height:t+"px",marginLeft:"-"+e/2+"px"}),Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container--rotating"),a.data("portal-working",!1)},350)):a.data("portal-working",!1)}},resetIframe:function(){this.targetMenuBtn&&this.targetMenuBtn.menu.$container.removeClass("dark"),Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container--resized"),Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container--tablet"),Craft.livePreview.$iframeContainer.removeClass("portal-lp-iframe-container--landscape"),Craft.livePreview.$iframe.css({width:"100%",height:"100%",left:0,marginLeft:0})}},{defaults:{siteId:null,targets:null,context:null,showBreakpoints:!0}});