{# @var craft \craft\web\twig\variables\CraftVariable #}
{#
/**
 * Portal plugin for Craft CMS 3.x
 *
 * Portal index.twig
 *
 * @author    Angell & Co
 * @copyright Copyright (c) 2018 Angell & Co
 * @link      https://angell.io
 * @package   Portal
 * @since     0.1.0
 */
#}
{% requireAdmin %}

{% extends "_layouts/cp" %}
{% set title = "Live Preview Targets"|t('portal') %}

{% block actionButton %}
    <a href="{{ url('portal/targets/new') }}" class="btn submit add icon">{{ "New Target"|t('portal') }}</a>
{% endblock %}

{% set crumbs = [
    { label: "Portal"|t('portal'), url: url('portal') },
    { label: "Live Preview"|t('app'), url: url('portal') }
] %}

{% set targets = craft.portal.targets.getAll() %}

{% block content %}
    <div class="field">
        <p id="notargets"{% if targets %} class="hidden"{% endif %}>
            {{ "No targets exist yet."|t('portal') }}
        </p>

        {% if targets %}
            <table id="targets" class="data fullwidth collapsible">
                <thead>
                <th scope="col">{{ "Target Name"|t('portal') }}</th>
                <th scope="col">{{ "Template"|t('app') }}</th>
                <td class="thin"></td>
                </thead>
                <tbody>
                {% for target in targets %}
                    <tr data-id="{{ target.id }}" data-name="{{ target.name }}">
                        <th scope="row" data-title="{{ 'Target Name'|t('portal') }}"><a href="{{ url('portal/targets/' ~ target.id) }}">{{ target.name|t('site') }}</a></th>
                        <td class="code" data-title="{{ 'Template'|t('app') }}">{{ target.handle }}</td>
                        <td class="thin"><a class="delete icon" title="{{ 'Delete'|t('app') }}"></a></td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        {% endif %}
    </div>
{% endblock %}

{% js %}
    var adminTable = new Craft.AdminTable({
        tableSelector: '#targets',
        noItemsSelector: '#notargets',
        deleteAction: 'portal/targets/delete',
        confirmDeleteMessage: '{{ "Are you sure you want to delete “{name}”?"|t('portal') }}',
    });
{% endjs %}
